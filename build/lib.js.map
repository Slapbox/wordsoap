{"version":3,"sources":["/Users/raine/projects/wordsoap/src/lib.js"],"names":["_$45870","require","cheerio$45871","regexes$45872","deadAttributes","source","classAttributes","nbsp","conditional","htmlComments","oleLink","emptyTags","emptyAttributes","deadTags","deadTagsAndContent","contentLine","url","regexesCompiled$45875","mapValues","a$45884","RegExp","clean1$45878","a$45885","replace","clean2$45881","a$45886","domClean$45882","html$45887","$$45888","load","prototype","replaceTag","newTag$45889","each","newEl$45890","html","text","after","remove","clean$45883","flow","module","exports","regexes","regexesCompiled"],"mappings":"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","file":"lib.js","sourcesContent":["'use strict'\n\nvar _ = require('lodash')\nvar cheerio = require(\"cheerio\")\n\nvar regexes = {\n\t// Inspired by: http://tim.mackey.ie/2005/11/23/CleanWordHTMLUsingRegularExpressions.aspx\n\n\t// endNote: /<span\\s+class=MsoEndnoteReference>([^]*)<\\/span>/.source,\n\n\tdeadAttributes: /(?:\\s+(?:id|lang|style|size|face|link|vlink|align|clear|xmlns(?::\\w+|[ovwxp\\w+])?))=(?:'[^']*'|\"\"[^\"\"]*\"\"|[^\\s>]+)/.source,\n\n\tclassAttributes: /(?:\\s+(?:class))=(?:'[^']*'|\"\"[^\"\"]*\"\"|[^\\s>]+)/.source,\n\n\tnbsp: /(<[^\\s>]*>&nbsp;<\\/[^\\s>]*>)|&nbsp;/.source,\n\n\t// https://regex101.com/r/sD4vJ8\n\tconditional: /<!-*\\[\\w+ [^\\]]*]>|<!\\[end[^\\]]*\\]-*>/.source,\n\n\thtmlComments: /<!--.*-->/.source,\n\n\toleLink: /<a\\s+name=\"OLE_LINK\\d+\">((?:.|[\\n])*?)<\\/a>/.source,\n\n\temptyTags: /<(?:p|i|b)[^>]*>\\s*<\\/[^>]+>/.source,\n\n\temptyAttributes: /\\s+\\w+=[\"']{2}/.source,\n\n\tdeadTags: /<\\/?(span|div|[ovwxp]:\\w+)[^>]*>/.source,\n\t// deadTags: /<\\/?(span|div|[ovwxp]:\\w+)[^>]*>/.source,\n\n\tdeadTagsAndContent: /<(xml|head)>[\\S\\s]*<\\/(xml|head)>/.source,\n\n\tcontentLine: /(.)\\n(?!\\n)/.source,\n\n\turl: /((?:(?:https?:\\/\\/)|(?:www\\.))[-a-zA-Z0-9@:%._\\+~#=]{2,256}\\.[a-z]{2,4}\\b(?:[-a-zA-Z0-9@:%_\\+~#?&/=]*(?:.\\w+)?))/.source,\n\n}\n\n// compile the regexes\nvar regexesCompiled = _.mapValues(regexes, λ[new RegExp(#, 'gi')])\n\n// clean, first parse (before cheerio)\nvar clean1 = λ\n\t// .replace(regexesCompiled.endNote, '<sup>$1</sup>')\n\t.replace(regexesCompiled.deadAttributes, '')\n\t.replace(regexesCompiled.nbsp, '')\n\t.replace(regexesCompiled.conditional, '')\n\t.replace(regexesCompiled.htmlComments, '')\n\t.replace(regexesCompiled.emptyAttributes, '')\n\t.replace(regexesCompiled.deadTagsAndContent, '')\n\t.replace(regexesCompiled.oleLink, '$1')\n\t.replace(regexesCompiled.contentLine, '$1 ')\n\n// second pass (after cheerio)\nvar clean2 = λ\n\t// regex literals break sweetjs here\n\t.replace(regexesCompiled.deadTags, '')\n\t.replace(regexesCompiled.classAttributes, '')\n\t.replace(regexesCompiled.emptyTags, '') // after emptyAttributes and deadTags\n\t.replace(regexesCompiled.url, '<a href=\"$1\">$1</a>')\n\t.replace(new RegExp('&quot;', 'gi'), '\"')\n\t.replace(new RegExp('\\n{3,}', 'gi'), '\\n\\n') // replace 3 or more newlines w/2\n\n// cleaning operations that\nvar domClean = function(html) {\n\n\tvar $ = cheerio.load(html)\n\n\t// only works on elements with static text content (in order to handle nested elements)\n\t$.prototype.replaceTag = function(newTag) {\n\t\tthis.each(function() {\n\t\t\tvar newEl = $('<' + newTag + '>').html($(this).text())\n\t\t\t$(this).after(newEl)\n\t\t})\n\t\tthis.remove()\n\t}\n\n\t$('.MsoEndnoteReference').replaceTag('sup')\n\treturn $.html()\n}\n\nvar clean = _.flow(clean1, domClean, clean2)\n\nmodule.exports = clean\nmodule.exports.regexes = regexes\nmodule.exports.regexesCompiled = regexesCompiled\n"],"sourceRoot":"/source/"}