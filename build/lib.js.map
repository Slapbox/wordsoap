{"version":3,"sources":["/Users/raine/projects/wordsoap/src/lib.js"],"names":["_$15836","require","cheerio$15837","iconv$15838","regexes$15839","deadAttributes","source","classAttributes","nbsp","conditional","htmlComments","oleLink","emptyTags","emptyAttributes","deadTags","deadTagsAndContent","contentLine","url","regexesCompiled$15842","mapValues","a$15853","RegExp","clean1$15845","a$15854","replace","clean2$15848","a$15855","domClean$15849","html$15856","$$15857","load","decodeEntities","prototype","replaceTag","newTag$15858","each","newEl$15859","html","text","after","remove","prepend","clean$15852","apply","arguments","module","exports","regexes","regexesCompiled"],"mappings":"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","file":"lib.js","sourcesContent":["'use strict'\n\nvar _ = require('lodash')\nvar cheerio = require(\"cheerio\")\nvar iconv = require('iconv-lite')\n\nvar regexes = {\n\t// Inspired by: http://tim.mackey.ie/2005/11/23/CleanWordHTMLUsingRegularExpressions.aspx\n\n\t// endNote: /<span\\s+class=MsoEndnoteReference>([^]*)<\\/span>/.source,\n\n\tdeadAttributes: /(?:\\s+(?:id|lang|style|size|face|link|vlink|align|clear|xmlns(?::\\w+|[ovwxp\\w+])?))=(?:'[^']*'|\"\"[^\"\"]*\"\"|[^\\s>]+)/.source,\n\n\tclassAttributes: /(?:\\s+(?:class))=(?:'[^']*'|\"\"[^\"\"]*\"\"|[^\\s>]+)/.source,\n\n\tnbsp: /(<[^\\s>]*>&nbsp;<\\/[^\\s>]*>)|&nbsp;/.source,\n\n\t// https://regex101.com/r/sD4vJ8\n\tconditional: /<!-*\\[\\w+ [^\\]]*]>|<!\\[end[^\\]]*\\]-*>/.source,\n\n\thtmlComments: /<!--.*-->/.source,\n\n\toleLink: /<a\\s+name=\"OLE_LINK\\d+\">((?:.|[\\n])*?)<\\/a>/.source,\n\n\temptyTags: /<(?:p|i|b)[^>]*>\\s*<\\/[^>]+>/.source,\n\n\temptyAttributes: /\\s+\\w+=[\"']{2}/.source,\n\n\tdeadTags: /<\\/?(span|div|[ovwxp]:\\w+)[^>]*>/.source,\n\t// deadTags: /<\\/?(span|div|[ovwxp]:\\w+)[^>]*>/.source,\n\n\tdeadTagsAndContent: /<(xml|head)>[\\S\\s]*<\\/(xml|head)>/.source,\n\n\tcontentLine: /(.)\\n(?!\\n)/.source,\n\n\turl: /((?:(?:https?:\\/\\/)|(?:www\\.))[-a-zA-Z0-9@:%._\\+~#=]{2,256}\\.[a-z]{2,4}\\b(?:[-a-zA-Z0-9@:%_\\+~#?&/=]*(?:.\\w+)?))/.source,\n\n}\n\n// compile the regexes\nvar regexesCompiled = _.mapValues(regexes, λ[new RegExp(#, 'gi')])\n\n// first parse (before cheerio)\nvar clean1 = λ\n\t// .replace(regexesCompiled.endNote, '<sup>$1</sup>')\n\t.replace(regexesCompiled.deadAttributes, '')\n\t.replace(regexesCompiled.nbsp, '')\n\t.replace(regexesCompiled.conditional, '')\n\t.replace(regexesCompiled.htmlComments, '')\n\t.replace(regexesCompiled.emptyAttributes, '')\n\t.replace(regexesCompiled.deadTagsAndContent, '')\n\t.replace(regexesCompiled.oleLink, '$1')\n\t.replace(regexesCompiled.contentLine, '$1 ')\n\n// second pass (after cheerio)\nvar clean2 = λ\n\t// regex literals break sweetjs here\n\t.replace(regexesCompiled.deadTags, '')\n\t.replace(regexesCompiled.classAttributes, '')\n\t.replace(regexesCompiled.emptyTags, '') // after emptyAttributes and deadTags\n\t.replace(regexesCompiled.url, '<a href=\"$1\">$1</a>')\n\t.replace(new RegExp('&quot;', 'gi'), '\"')\n\t.replace(new RegExp('\\n{3,}', 'gi'), '\\n\\n') // replace 3 or more newlines w/2\n\n// Because regexes cannot match nested expressions (such as the MsoEndNoteReference elements that delineate footnotes), we must parse the HTML. Cheerio gives us the parsing and querying that we need without the heaviness of a full simulated DOM like jsdom.\nvar domClean = function(html) {\n\n\tvar $ = cheerio.load(html, {\n\t\tdecodeEntities: false\n\t})\n\n\t// only works on elements with static text content (in order to handle nested elements)\n\t$.prototype.replaceTag = function(newTag) {\n\t\tthis.each(function() {\n\t\t\tvar newEl = $('<' + newTag + '>').html($(this).text())\n\t\t\t$(this).after(newEl)\n\t\t})\n\t\tthis.remove()\n\t}\n\n\t$('.MsoEndnoteReference').replaceTag('sup')\n\n\t$('html').prepend('<head><meta charset=\"utf-8\"></head>')\n\n\treturn $.html()\n}\n\nvar clean = clean1 +| domClean +| clean2\n\nmodule.exports = clean\nmodule.exports.regexes = regexes\nmodule.exports.regexesCompiled = regexesCompiled\n"],"sourceRoot":"/source/"}